<?php $__env->startSection('head'); ?>
    <link href="<?php echo e(asset('/css/oneCompany.css')); ?>" rel="stylesheet">
<?php $__env->stopSection(); ?>
<?php $__env->startSection('content'); ?>
    <?php echo $__env->make('newDesign.scrollup', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>

    <?php echo $__env->make('newDesign.breadcrumb',array('breadcrumbs' =>[
       ['url'=> 'head','name'=>'Головна'],
       ['name' => 'Компанія: '.$company->company_name, 'url' => false]
       ])
    , array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>

    <?php echo Form::file('fileImg', array( 'id'=>'fileImg', 'style'=>'display:none', 'accept'=>'.jpg, .jpeg, .gif, .png, .svg')); ?>

    <input type="hidden" name="fcoords" id="coords" class="coords" value="" data-id="<?php echo e($company->id); ?>">
    <input type="hidden" name="_token" value="<?php echo e(csrf_token()); ?>">

        <div class="row">
            <div class="col-md-2">
                <div class="logos">

                    <div class="panel panel-orange" id="vimg">
                        <?php if(File::exists(public_path('image/company/' . $company->users_id .'/'. $company->image)) and $company->image != ''): ?>
                            <?php echo Html::image('image/company/' . $company->users_id .'/'. $company->image, 'logo', ['id' => 'vacImg', 'width' => '100%', 'height' => '100%']); ?>

                        <?php else: ?>
                            <?php echo Html::image('image/company_tmp.png', 'logo', array('id' => 'vacImg', 'width' => '100%', 'height' => '100%')); ?>

                        <?php endif; ?>
                    </div>

                    <?php if(Auth::check() && Auth::id() == $company->users_id): ?>
                    <div class="change-img-myresume">
                        <span class="orange-link-myresume"  id="changeImage">
                            <span class="glyphicon glyphicon-repeat" aria-hidden="true"></span>
                            <span><?php echo e(trans('company.changephoto')); ?></span>
                        </span>
                    </div>
                    <?php endif; ?>
                    <div class="case">
  						<span>
                            <a href="#">
                                <i class="fa newFa">&#xf0b1;</i>
                            </a>
  						</span>
                        <div class="consult">
                            <a href="#"><?php echo e(trans('company.planaconsultation')); ?></a>
                        </div>
                    </div>
                    <?php echo $__env->make('newDesign.socialModule.share-btn-block' , ['url' => URL::current()], array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>
                </div>
            </div>
        </div>

        <div class="col-md-10 contentConpany">

                <div class="panelHeadings">
                    <div class="textCompany">
                        <a class="greyLinks" href="javascript:submit('companies' <?php echo e($company->id); ?>)">
                            <?php echo e($company->company_name); ?>

                        </a>
                    </div>
                </div>

                <div class="row textCompany">

                    <div class="col-xs-12 text_com">
                        <div class="ratings">
                            <span class = "ratingsTitle"><?php echo e(trans('content.rating')); ?></span>
                            <span class="morph">
                                <?php echo Html::image(asset('image/like.png'), 'like', ['class'=>'likeDislike']); ?>

                                <span class="findLike" id="<?php echo e(route('com.rate', $company->id)); ?>_1">
                                    <?php echo e($company->rated()->getLikes($company)); ?>

                                </span>
                            </span>
                            <span class="morph">
                                <?php echo Html::image(asset('image/dislike.png'), 'dislike', ['class'=>'likeDislike']); ?>

                                <span class="findDislike" id="<?php echo e(route('com.rate', $company->id)); ?>_-1">
                                    <?php echo e($company->rated()->getDisLikes($company)); ?>

                                </span>
                            </span>
                            <span class="likeError"></span>
                        </div>
                    </div>

                    <div class="col-xs-3 text_com">
                        <span> <?php echo e(trans('company.Abbreviation')); ?></span>
                    </div>
                    <div class="col-xs-9 text_com">
                        <span><?php echo e(!empty($company->short_name) ? $company->short_name : "Не вказано"); ?></span>
                    </div>

                    <div class="col-xs-3 text_com">
                        <span><?php echo e(trans('form.branch')); ?>: </span>
                    </div>
                    <div class="col-xs-9 text_com">
                        <span><?php echo e(!empty($industry->name) ? $industry->name : "Не вказано"); ?></span>
                    </div>


                    <div class="col-xs-3 text_com">
                        <span><?php echo e(trans('company.links')); ?> </span>
                    </div>
                    <?php if(!empty($company->link)): ?>
                        <div class="col-xs-9 text_com">
                            <a class="orangeLinks" href="<?php echo e($company->link); ?>"><?php echo e($company->link); ?></a>
                        </div>
                    <?php else: ?>
                        <div class="col-xs-9 text_com">
                            <span>Не вказано</span>
                        </div>
                    <?php endif; ?>

                    <div class="col-xs-3 text_com">
                        <span> <?php echo e(trans('company.City')); ?></span>
                    </div>
                    <div class="col-xs-9 text_com">
                        <span><?php echo e(!empty($city->name) ? $city->name : "Не вказано"); ?></span>
                    </div>

                    <div class="col-xs-3 text_com">
                        <span><?php echo e(trans('form.email')); ?>: </span>
                    </div>
                    <div class="col-xs-9 text_com">
                        <span><?php echo e(!empty($company->company_email) ? $company->company_email : "Не вказано"); ?></span>
                    </div>

                    <div class="col-xs-3 text_com">
                        <span><?php echo e(trans('main.phone')); ?></span>
                    </div>
                    <div class="col-xs-9 text_com">
                        <span><?php echo e(!empty($company->phone) ? $company->phone : "Не вказано"); ?></span>
                    </div>

                    <div class="col-xs-12 textCompany verticalIndent">
                        <span class="anagraph verticalIndent"><?php echo e(trans('company.Details')); ?> </span>
                    </div>
                    <div class="col-xs-12 description">
                       <span>
                           <?php echo !empty($company->description) ?
                            strip_tags(
                                $company->description,
                                '<em><a><s><p><span><b><ul><ol><li><strong><h1><h2><h3><h4><h5><blockquote><body><table><tr><td>'
                            ) :
                           "Детальна інформація про компанію відсутня."; ?>

                       </span>
                    </div>

                    <div class="col-xs-12 textCompany verticalIndent">
                        <span class="anagraph verticalIndent"><?php echo e(trans('company.vacancies')); ?> </span>
                        <?php if(!empty($vacancies[0])): ?>
                            <?php foreach($vacancies as $vacancy): ?>
                                <div class="description">
                                    <a class="links" href="/vacancy/<?php echo e($vacancy->id); ?>">
                                        <?php echo e($vacancy->position); ?>

                                    </a>
                                    &nbsp;&nbsp;&nbsp;&nbsp;
                                    <?php echo e(date('j m Y', strtotime($vacancy->created_at))); ?>

                                </div>
                            <?php endforeach; ?>
                        <?php else: ?>
                            <p><?php echo e(trans('company.noactiveVacansies')); ?></p>
                        <?php endif; ?>

                        <?php if(Auth::check() && Auth::user()->isAdmin()): ?>
                            <div>
                                <button class="btn btn-default" style="background: #f48952" onclick="blockCompany()">
                                    Заблокувати
                                </button>
                            </div>
                        <?php endif; ?>

                    </div>
                </div>
            <hr/>

            <div class="button_company">
                <?php if(Auth::check() && Auth::id() == $company->users_id): ?>
                <a href="<?php echo e($company->id); ?>/destroy" class="btn-default btn"
                   onclick="return confirm('Ви дійсно бажаєте видалити коментарій?');"><?php echo e(trans('main.delete')); ?></a>
                <a href="<?php echo e($company->id); ?>/edit" class="btn-default btn"><?php echo e(trans('main.edit')); ?></a>
                <?php endif; ?>
                <a href="<?php echo e(route('company.response.index',$company->id)); ?>" class="response-call btn-default btn"><?php echo e(trans('main.respond')); ?></a>
                <a href="<?php echo e(route('scompany.company_formSendFile',$company->id)); ?>" class="file-call btn-default btn"><?php echo e(trans('main.sendfile')); ?></a>
                <a href="<?php echo e(route('scompany.company_formSendResume',$company->id)); ?>" class="resume-call btn-default btn"><?php echo e(trans('main.sendresume')); ?></a>
            </div>

        </div>
    </div>

    <div class="downlist col-xs-10 col-xs-offset-2"></div>

    <?php foreach($comments as $comment): ?>
        <div id="comment-block-<?php echo e($comment->id); ?>" class="col-xs-10 col-xs-offset-2">
            <span>Автор: <?php echo e($comment->user->name); ?></span>
            <span>, дата:
                <span id="date-<?php echo e($comment->id); ?>"><?php echo e(date('j.m.Y h:ia', strtotime($comment->updated_at))); ?></span>
            </span>
            <p id="comment-<?php echo e($comment->id); ?>-description"><?php echo e($comment->comment); ?></p>
            <?php if(Auth::check() && (Auth::id() == $comment->user_id || Auth::user()->isAdmin()) ): ?>
                <div class="btn-block">
                <?php echo Form::model($comment,
                    ['route' => [
                        'company.response.update',
                        $company->id,
                        $comment->id
                        ],
                    'method'=>'PUT']); ?>

                <?php echo Form::textarea( 'comment', $comment->comment,
                    [
                        'id' => 'comment'.$comment->id,
                        'value' => $comment->id,
                        'class' => 'textarea-edit form-control',
                        'style' => 'height: 100px; display:none'
                    ]); ?>

                <?php echo Form::button('<i class="fa fa-pencil fa-lg"></i>',
                    [
                        'value' => $comment->id,
                        'id' => 'btn-edit-submit'.$comment->id,
                        'class' => 'btn-edit-submit btn btn-xs btn-warning pull-right'
                    ]); ?>

                <?php echo Form::close(); ?>

                <?php echo Form::model($comment,
                    ['route' => [
                        'company.response.destroy',
                        $company->id,
                        $comment->id,
                        ],
                    'method'=>'DELETE']); ?>

                <?php echo Form::button('<i class="fa fa-times fa-lg"></i>',
                    [
                        'type' => 'submit',
                        'id' => $comment->id,
                        'class' => 'btn-delete btn btn-xs btn-warning pull-right',
                        'onclick' => "return confirm('Ви дійсно бажаєте видалити коментарій?');"
                    ]); ?>

                <?php echo Form::close(); ?>

            </div>
            <?php endif; ?>
        </div>
    <?php endforeach; ?>

    <?php echo Html::script('js/socialNetWork.js'); ?>


    <script>
        socialNetWork('.social > a');
    </script>

    <div id="changeImageBox" class="modal fade">
        <?php echo $__env->make('newDesign.cropModal', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>
    </div>

    <?php echo Html::script('js/crop.js'); ?>


    <script>
    function blockCompany() {
        var dialogResult = confirm("Ви дійсно бажаєте заблокувати компанію?");
        if(dialogResult) {
            $.post( '/company/<?php echo e($company->id); ?>/block', {_token: '<?php echo e(csrf_token()); ?>', id: '<?php echo e($company->id); ?>'},
                function( data ) {
                    location="<?php echo e(URL::to('company')); ?>";
                });
        }
    }
    $(document).ready(function () {
        $("button.btn-edit-submit").on('click', function () {
            id = $(this).val();
            $("#comment-" + id + "-description").hide();
            $(this).removeClass('btn-primary').addClass('btn-success');
            attributes = $(this).attr("class");
            buttonName = $(this).html();
            $("#comment" + id).show();
            $(this).replaceWith('<button class=\'' + attributes + '\' type=\'submit\' >' + buttonName + '</button>');
        });

        $('#changeImage').on('click', function () {
            $('#fileImg').click();
        });

        $('#fileImg').on('change', function (e) {
            $('#changeImageBox').modal({
                show: true,
                backdrop: 'static'
            });
            crop(e, 'img-src', '#crop', '#changeImageBox');
        });

        $('#changeImageBox').on('hidden.bs.modal', function () {
            if($('#coords').val()){
                var $input = $("#fileImg");
                var fd = new FormData;
                fd.append('fileImg', $input.prop('files')[0]);
                fd.append('coords', $('.coords').val());
                fd.append('id', $('.coords').attr('data-id'));
                $.ajax({
                    url: '<?php echo e(route('upimgcom')); ?>',
                    data: fd,
                    processData: false,
                    contentType: false,
                    type: 'POST',
                    success: function (data) {
                        $('#vimg img').attr('src', window.location.origin + '/' + data);
                    }
                });
            }
        });

        $.ajaxSetup({
            headers: {
                'X-CSRF-TOKEN': $('input[name="_token"]').val()
            }
        });

        $('a.vac-call, a.file-call, a.resume-call, a.response-call').click(function () {
            var that = this;
            var link = $(this).attr('href');
            if($(that).hasClass('active')){
                $(that).removeClass('active');
                $('.downlist').hide('slow');
            }else{
                $.ajaxSetup({headers: {'X-CSRF-TOKEN': $('meta[name="_token"]').attr('content')}});
                $.ajax({
                    url: link,
                    success: function(data){
                        $('.active').removeClass('active');
                        $('.downlist').show('slow').html(data);
                        $(that).addClass('active');
                    }
                })
            }
            return false;
        })
    })
    </script>
<?php $__env->stopSection(); ?>

<?php echo $__env->make('app', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>